function roundDecimal(e,t){t=t||2;var o=Math.pow(10,t);return Math.round(e*o)/o}function onMapClick(e){positions.push({lat:e.latlng.lat,lng:e.latlng.lng});L.marker({lat:e.latlng.lat,lng:e.latlng.lng}).addTo(map);notyf.success("Position prise en compte!")}function affichage_points(){var e=0;document.querySelector("#points").innerHTML="",positions.forEach(function(t){e+=1;var o=` Points n¬∞ ${e}:  Lng : ${t.lng}  et  Lat : ${t.lat}`,r=document.createTextNode(o);let n=document.createElement("li");n.appendChild(r),document.querySelector("#points").appendChild(n)}),document.querySelector("#info_reset").classList.remove("btn-primary"),document.querySelector("#info_reset").classList.add("btn-danger"),document.querySelector("#afficher_positions").classList.remove("btn-primary"),document.querySelector("#afficher_positions").classList.add("btn-outline-success")}function product_style(){var e=positions.length-1;const t=L.marker([positions[0].lat,positions[0].lng],{icon:icoRed}).bindPopup("<center>Depart !</center>");addOjectOnMap(t,map);const o=L.marker([positions[e].lat,positions[e].lng],{icon:icoGreen}).bindPopup("<center>Arriv√©e !</center>");if(addOjectOnMap(o,map),positions.length>2)for(var r=1;r<e;r++){const e=L.marker([positions[r].lat,positions[r].lng],{icon:icoOrange}).bindPopup(`<center>position : ${r}</center>`);addOjectOnMap(e,map)}}function message_positions(){0==positions.length&&(notyf.error("Aucune position prise en compte"),notyf.open({type:"warning",message:"Recommencer, Merci!",duration:4e3}))}function distance_routing(){affichage_points();var e=positions.length-1;if(0==positions.length)notyf.error("Aucune position prise en compte"),notyf.open({type:"warning",message:"Recommencer, Merci!",duration:4e3}),document.querySelector("#info_reset").classList.add("btn-primary"),document.querySelector("#info_reset").classList.remove("btn-danger"),document.querySelector("#afficher_positions").classList.add("btn-primary"),document.querySelector("#afficher_positions").classList.remove("btn-outline-success");else if(positions.length>1&&positions.length<3){product_style();var t=turf.point([parseFloat(positions[0].lng),parseFloat(positions[0].lat)]),o=turf.point([positions[e].lng,positions[e].lat]),r={units:"kilometers"},n=turf.rhumbDistance(t,o,r);document.querySelector("#turf").value=`${roundDecimal(n)} KM`;var c={longitude:positions[0].lng,latitude:positions[0].lat},a={longitude:positions[e].lng,latitude:positions[e].lat},s=window.geolib.getDistance(c,a)/1e3;document.querySelector("#geolib").value=`${s} KM`,document.querySelector("#remove_distance").classList.remove("btn-primary"),document.querySelector("#remove_distance").classList.add("btn-dark")}else notyf.open({type:"warning",message:"Il faut 2 positions ! Merci",duration:2e3})}function centre_routing(){affichage_points();var e=positions.slice(-2),t=e.length-1;if(0==positions.length)notyf.error("Aucune position prise en compte"),notyf.open({type:"warning",message:"Recommencer, Merci!",duration:4e3}),document.querySelector("#info_reset").classList.add("btn-primary"),document.querySelector("#info_reset").classList.remove("btn-danger"),document.querySelector("#afficher_positions").classList.add("btn-primary"),document.querySelector("#afficher_positions").classList.remove("btn-outline-success");else if(positions.length>1&&positions.length<3){product_style();var o={longitude:positions[0].lng,latitude:positions[0].lat},r={longitude:positions[t].lng,latitude:positions[t].lat},n=window.geolib.getCenter([o,r]);document.querySelector("#lat_centre_geolib").value=`Lat : ${n.latitude}`,document.querySelector("#lng_centre_geolib").value=`Lng:  ${n.longitude}`;const e=L.marker([n.latitude,n.longitude],{icon:icoYellow}).bindPopup("<center>Centre Calcul√© !</center>");addOjectOnMap(e,map),document.querySelector("#remove_centre").classList.remove("btn-primary"),document.querySelector("#remove_centre").classList.add("btn-dark")}else notyf.open({type:"warning",message:"Il faut 2 positions !",duration:2e3})}function buffer_turf(e,t,o){if(positions.length>0){message_positions();var r=turf.buffer(e,o,t),n=L.geoJSON(r);layerIds.push(n._leaflet_id),markerGroup.addLayer(n),document.querySelector("#r_buffer").value=`${o} KM`,document.querySelector("#remove_buffer").classList.remove("btn-primary"),document.querySelector("#remove_buffer").classList.add("btn-dark")}else document.querySelector("#info_reset").classList.add("btn-primary"),document.querySelector("#info_reset").classList.remove("btn-danger"),document.querySelector("#afficher_positions").classList.add("btn-primary"),document.querySelector("#afficher_positions").classList.remove("btn-outline-success")}function buffer_routing(){if(positions.length>0){message_positions(),affichage_points();var e=document.querySelector("#r_buffer").value,t=positions.length-1;if(""==e){e=10;var o=turf.point([parseFloat(positions[t].lng),parseFloat(positions[t].lat)]),r={units:"kilometers"};buffer_turf(o,r,e)}else if(e.match(/[+-]?([0-9]*[.])?[0-9]+/)){o=turf.point([parseFloat(positions[t].lng),parseFloat(positions[t].lat)]),r={units:"kilometers"};buffer_turf(o,r,e)}else notyf.error(" Type num√©rique ou decimal ! Merci...üòä"),notyf.open({type:"warning",message:"Recommencer, Merci!",duration:4e3})}else notyf.error("Aucune position prise en compte"),notyf.open({type:"warning",message:"Recommencer, Merci!",duration:4e3}),document.querySelector("#info_reset").classList.add("btn-primary"),document.querySelector("#info_reset").classList.remove("btn-danger"),document.querySelector("#afficher_positions").classList.add("btn-primary"),document.querySelector("#afficher_positions").classList.remove("btn-outline-success")}function effacer_buffer(){""!=document.querySelector("#r_buffer").value&&notyf.success(`buffer de rayon :${document.querySelector("#r_buffer").value} effac√© avec succ√®s, Merci. !`),layerIds.forEach(function(e){markerGroup.removeLayer(e)}),layerIds=[],document.querySelector("#r_buffer").value="",document.querySelector("#points").innerHTML="",document.querySelector("#remove_buffer").classList.add("btn-primary"),document.querySelector("#remove_buffer").classList.remove("btn-dark")}function routing_geoportail(){if(positions.length>0?(message_positions(),affichage_points(),product_style()):(document.querySelector("#info_reset").classList.add("btn-primary"),document.querySelector("#info_reset").classList.remove("btn-danger"),document.querySelector("#afficher_positions").classList.add("btn-primary"),document.querySelector("#afficher_positions").classList.remove("btn-outline-success")),positions.length>1){notyf.success("Connexion : geoportail.gouv.fr ");var e=positions.length-1,t=`${positions[0].lng},${positions[0].lat}`,o=`${positions[e].lng},${positions[e].lat}`,r="";if(positions.length>2)for(var n=1;n<e;n++)r+=`${positions[n].lng},${positions[n].lat};`;var c=`${apiUrl}?origin=${t}&destination=${o}`;""!==r&&(c+=`&waypoints=${r}`),fetch(c).then(function(e){return e.json()}).then(function(e){var t=e.geometryWkt,o=omnivore.wkt.parse(t);layer_routing=L.featureGroup([o]),addOjectOnMap(layer_routing,map),document.querySelector("#distance_geoportail").value=e.distance,document.querySelector("#duration_geoportail").value=e.duration,document.querySelector("#remove_geoportail").classList.remove("btn-primary"),document.querySelector("#remove_geoportail").classList.add("btn-dark")})}else notyf.error("Au moins deux positions !"),notyf.open({type:"warning",message:"Recommencer, Merci!",duration:4e3})}function etl_adresse(e){let t=!0,o=e;do{if(o=o.replace(" ","+"),-1==o.indexOf(" "))return t=!1,o}while(t)}async function geoCode(e){let t=document.querySelector("#choice_param_1").checked,o=18;if(1==t){notyf.success("Connexion : data.gouv.fr"),notyf.open({type:"warning",message:"Uniquement la FRANCE",duration:4e3});var r=etl_adresse(e);let t=`https://api-adresse.data.gouv.fr/search/?q=${r}`,c=await fetch(t),a=await c.json(),s=a.features[0].geometry.coordinates;if(s.length>0){let e=parseFloat(s[1]).toFixed(4),t=parseFloat(s[0]).toFixed(4);if(document.querySelector("#lat_geocodage").value=e,document.querySelector("#lng_geocodage").value=t,1==document.querySelector("#position_map_1").checked){var n="data.gouv.fr";position_map(e,t,icoBlue,n,layer_geocodeIds,o)}}else document.querySelector("#lat_geocodage").value="Non trouv√©",document.querySelector("#lng_geocodage").value="Non trouv√©"}else{notyf.success("Connexion : ORSM");let t=`https://nominatim.openstreetmap.org/search/?format=json&q=${e}`,r=await fetch(t),c=await r.json();if(c.length>0){let e=parseFloat(c[0].lat).toFixed(4),t=parseFloat(c[0].lon).toFixed(4);if(document.querySelector("#lat_geocodage").value=e,document.querySelector("#lng_geocodage").value=t,1==document.querySelector("#position_map_1").checked){n="ORSM";position_map(e,t,icoOrange,n,layer_geocodeIds,o)}}else document.querySelector("#lat_geocodage").value="Non trouv√©",document.querySelector("#lng_geocodage").value="Non trouv√©"}}async function geoDecode(e,t){document.querySelector("#geodecodage_adresse").value=" patientez... ";let o=18,r=document.querySelector("#choice_param_2").checked;if(1==r){notyf.success("Connexion : data.gouv.fr"),notyf.open({type:"warning",message:"Uniquement la FRANCE",duration:4e3});let r=`https://api-adresse.data.gouv.fr/reverse/?lat=${e}&lon=${t}`,c=await fetch(r),a=await c.json();if(a.features.length>0){if(document.querySelector("#geodecodage_adresse").value=a.features[0].properties.label,1==document.querySelector("#position_map_2").checked){var n="data.gouv.fr";position_map(e,t,icoBlue,n,layer_geodecodeIds,o)}}else document.querySelector("#geodecodage_adresse").value="Non trouv√©"}else{notyf.success("Connexion : ORSM");let r=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${t}`,c=await fetch(r),a=await c.json();if(a.display_name.length>0){if(document.querySelector("#geodecodage_adresse").value=a.display_name,1==document.querySelector("#position_map_2").checked){n="ORSM";position_map(e,t,icoOrange,n,layer_geodecodeIds,o)}}else document.querySelector("#geodecodage_adresse").value="Non trouv√©"}}function effacer_1(){document.querySelector("#lat_geocodage").value="",document.querySelector("#lng_geocodage").value="",document.querySelector("#geocodage_adresse").value="",document.querySelector("#calcul_geocodage_adresse").classList.add("btn-primary"),document.querySelector("#calcul_geocodage_adresse").classList.remove("btn-success"),document.querySelector("#effacer_geocodage_adresse").classList.add("btn-primary"),document.querySelector("#effacer_geocodage_adresse").classList.remove("btn-dark"),layer_geocodeIds.forEach(function(e){markerGroup.removeLayer(e)}),layer_geocodeIds=[];let e=46.227638,t=2.213749,o=6;MapAnimation(e,t,o,map)}function effacer_2(){document.querySelector("#lat_geodecodage").value="",document.querySelector("#lng_geodecodage").value="",document.querySelector("#geodecodage_adresse").value="Adresse",document.querySelector("#calcul_geodecodage").classList.add("btn-primary"),document.querySelector("#calcul_geodecodage").classList.remove("btn-success"),document.querySelector("#effacer_geodecodage").classList.add("btn-primary"),document.querySelector("#effacer_geodecodage").classList.remove("btn-dark"),layer_geodecodeIds.forEach(function(e){markerGroup.removeLayer(e)}),layer_geodecodeIds=[];let e=46.227638,t=2.213749,o=6;MapAnimation(e,t,o,map)}function ctrl_btn(e,t){document.querySelector(e).addEventListener("click",o=>{"btn btn-success"!=document.querySelector(e).className?(document.querySelector(e).classList.remove("btn-outline-success"),document.querySelector(e).classList.add("btn-success"),notyf.success("Fonctionnalit√© activ√©e !")):(document.querySelector(e).classList.remove("btn-success"),document.querySelector(e).classList.add("btn-outline-success"),notyf.error("Fonctionnalit√© d√©sactiv√©e !"));var r=document.querySelector(t).classList.contains("on_btn");document.querySelector(t).classList.toggle("on_btn"),Velocity(document.querySelector(t),r?"fadeIn":"fadeOut",{duration:1200}),o.preventDefault()})}function loadUrlTemperature(e){let t=e.coords.latitude,o=e.coords.longitude,r=`${URL_MAIN}?lat=${t}&lon=${o}&units=${UNITS}&APPID=${API_KEY}`;fetchApi(r)}async function fetchApi(e){let t=await fetch(e),{main:o,name:r}=await t.json();const n=o.temp.toFixed(1);var c=50,a=1,s=!0;n<0?(c=100,a=2):n<-5?(c=150,a=3):n>2&&(s=!0);new Snowflakes({color:"#5ECDEF",container:document.body,count:c,speed:a,stop:s,rotation:!0,minOpacity:.1,maxOpacity:.95,minSize:10,maxSize:25,types:6,width:void 0,height:void 0,wind:!0,zIndex:9999,autoResize:!0})}import{map,icoRed,icoGreen,icoBlue,icoOrange,icoPurple,icoYellow}from"./app.js";import{markColor,addOjectOnMap,CentreMap,createMap,createCircle,MapAnimation}from"./map.js";const d=new Date;let year=d.getFullYear();document.querySelector(".year").textContent=year;var notyf=new Notyf({duration:3e3,position:{x:"right",y:"top"},types:[{type:"warning",background:"orange",icon:{className:"material-icons",tagName:"i",text:"warning"}}]}),positions=[],apiUrl="https://wxs.ign.fr/choisirgeoportail/itineraire/rest/route.json",layer_routing="",layer_buffer="",markerGroup=L.layerGroup();addOjectOnMap(markerGroup,map);var layerIds=[],layer_geocodeIds=[],layer_geodecodeIds=[];map.on("click",onMapClick),document.querySelector("#afficher_positions").addEventListener("click",affichage_points),document.querySelector("#calcul_distance").addEventListener("click",distance_routing),document.querySelector("#remove_distance").addEventListener("click",()=>{document.querySelector("#turf").value="",document.querySelector("#geolib").value="",document.querySelector("#remove_distance").classList.add("btn-primary"),document.querySelector("#remove_distance").classList.remove("btn-dark")}),document.querySelector("#calcul_centre").addEventListener("click",centre_routing),document.querySelector("#remove_centre").addEventListener("click",()=>{document.querySelector("#lat_centre_geolib").value="",document.querySelector("#lng_centre_geolib").value="",document.querySelector("#remove_centre").classList.add("btn-primary"),document.querySelector("#remove_centre").classList.remove("btn-dark")}),document.querySelector("#calcul_buffer").addEventListener("click",buffer_routing),document.querySelector("#remove_buffer").addEventListener("click",effacer_buffer),document.querySelector("#routing_geoportail").addEventListener("click",routing_geoportail),document.querySelector("#remove_geoportail").addEventListener("click",()=>{document.querySelector("#distance_geoportail").value="",document.querySelector("#duration_geoportail").value="",document.querySelector("#remove_geoportail").classList.add("btn-primary"),document.querySelector("#remove_geoportail").classList.remove("btn-dark")}),document.addEventListener("DOMContentLoaded",function(){document.querySelector("#itineraire_cache").addEventListener("click",function(){let e=this.checked;1==e?layer_routing.setStyle({opacity:1}):layer_routing.setStyle({opacity:0})})}),document.querySelector("#info_reset").addEventListener("click",function(){positions=[],document.querySelector("#points").innerHTML="",document.querySelector("#geolib").value="",document.querySelector("#turf").value="",document.querySelector("#lat_centre_geolib").value="",document.querySelector("#lng_centre_geolib").value="",document.querySelector("#lat_centre_geolib").value="",document.querySelector("#lng_centre_geolib").value="",document.querySelector("#r_buffer").value="",document.querySelector("#distance_geoportail").value="",document.querySelector("#duration_geoportail").value="",document.querySelector("#info_reset").classList.add("btn-primary"),document.querySelector("#info_reset").classList.remove("btn-danger"),document.querySelector("#ChargerData").classList.add("btn-primary"),document.querySelector("#ChargerData").classList.remove("btn-success"),document.querySelector("#afficher_positions").classList.add("btn-primary"),document.querySelector("#afficher_positions").classList.remove("btn-outline-success"),markerGroup.clearLayers(),notyf.dismissAll(),window.location.reload(!0)}),interact(".item").draggable({onmove:function(e){const t=e.target,o=t.getAttribute("data-x"),r=t.getAttribute("data-y"),n=parseFloat(o)||0,c=parseFloat(r)||0,a=e.dx,s=e.dy,i=n+a,l=c+s;t.style.transform=`translate(${i}px, ${l}px)`,t.setAttribute("data-x",i),t.setAttribute("data-y",l)},inertia:!0,restrict:{restriction:"parent"}}),interact(".dropzone").dropzone({accept:".item",overlap:.75,ondropactivate:function(e){const t=e.relatedTarget;t.classList.add("dragging")},ondropdeactivate:function(e){const t=e.relatedTarget;t.classList.remove("dragging","cannot-drop")},ondragenter:function(e){const t=e.relatedTarget;t.classList.remove("cannot-drop"),t.classList.add("can-drop")},ondragleave:function(e){const t=e.relatedTarget;t.classList.remove("can-drop"),t.classList.add("cannot-drop")}});var position_map=(e,t,o,r,n,c)=>{var a=`<h5>[${e} , ${t}]</h5>`;a+=`<h5> Source : ${r}</h5>`;var s=L.marker([e,t],{icon:o,CustomId:id}).bindPopup(`${a}`).openPopup();n.push(s),markerGroup.addLayer(s),MapAnimation(e,t,c,map)};document.querySelector("#calcul_geocodage_adresse").addEventListener("click",()=>{var e=document.querySelector("#geocodage_adresse").value;""!=e?(document.querySelector("#calcul_geocodage_adresse").classList.remove("btn-primary"),document.querySelector("#calcul_geocodage_adresse").classList.add("btn-success"),document.querySelector("#effacer_geocodage_adresse").classList.remove("btn-primary"),document.querySelector("#effacer_geocodage_adresse").classList.add("btn-dark"),geoCode(e)):(notyf.error("Champ adresse vide"),notyf.open({type:"warning",message:"Recommencer, Merci!",duration:4e3}))}),document.querySelector("#calcul_geodecodage").addEventListener("click",()=>{var e=document.querySelector("#lat_geodecodage").value,t=document.querySelector("#lng_geodecodage").value;e.length>0&&t.length>0?e.match(/[+-]?([0-9]*[.])?[0-9]+/)||t.match(/[+-]?([0-9]*[.])?[0-9]+/)?(e=parseFloat(e),t=parseFloat(t),document.querySelector("#calcul_geodecodage").classList.remove("btn-primary"),document.querySelector("#calcul_geodecodage").classList.add("btn-success"),document.querySelector("#effacer_geodecodage").classList.remove("btn-primary"),document.querySelector("#effacer_geodecodage").classList.add("btn-dark"),geoDecode(e,t)):(notyf.error("Champs Latitude et longitude ne sont pas num√©riques"),notyf.open({type:"warning",message:"Recommencer, Merci!",duration:4e3})):(notyf.error("Champs latitude et longitude sont vides"),notyf.open({type:"warning",message:"Recommencer, Merci!",duration:4e3}))}),document.querySelector("#effacer_geocodage_adresse").addEventListener("click",effacer_1),document.querySelector("#effacer_geodecodage").addEventListener("click",effacer_2),document.querySelector("#reog").addEventListener("click",()=>{var e=document.querySelector("#reog").className;if(e=e.replace("btn btn-primary mb-3 mt-3 ",""),"reog"!=e){var t=document.querySelector(".dropzone"),o=t.querySelectorAll(".item_off");document.querySelector("#reog").className+=" reog",o.forEach(function(e){e.classList.remove("item_off"),e.className+=" item"}),notyf.success("Vous pouvez r√©organiser les boites de fonctionnalit√©s")}else{t=document.querySelector(".dropzone"),o=t.querySelectorAll(".item");document.querySelector("#reog").classList.remove("reog"),o.forEach(function(e){e.classList.remove("item"),e.className+=" item_off"}),notyf.success("Fonction de r√©organisation d√©sactiv√©e !")}}),ctrl_btn("#btn_distance","#active_distance"),ctrl_btn("#btn_centre","#active_centre"),ctrl_btn("#btn_buffer","#active_buffer"),ctrl_btn("#btn_routing","#active_routing"),ctrl_btn("#btn_geo","#active_geo"),function(){let e=document.querySelector("#btn_lateral_hz");e.addEventListener("click",t=>{"btn btn-success"!=e.className?(e.classList.remove("btn-outline-success"),e.classList.add("btn-success"),document.querySelector("#barreHoz").style.transform="translateX(830px)",notyf.success("Fonctionnalit√© activ√©e !")):(e.classList.remove("btn-success"),e.classList.add("btn-outline-success"),document.querySelector("#barreHoz").style.transform="translateX(0px)",notyf.error("Fonctionnalit√© d√©sactiv√©e !")),t.preventDefault()})}();const URL_MAIN="https://api.openweathermap.org/data/2.5/weather",API_KEY="8f57cb746c4c1d4b48b7f35eba6f6230",UNITS="metric";navigator.geolocation.getCurrentPosition(loadUrlTemperature);